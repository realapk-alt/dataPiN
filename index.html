<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PIN Slot Manager</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body{margin:0;background:#0b0b10;color:#fff;font-family:system-ui}
.card{max-width:460px;margin:14px auto;background:#12121a;padding:16px;border-radius:16px}
h2{margin:6px 0}
input,textarea,button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none;font-size:14px}
textarea{resize:none}
button{background:#00ff88;color:#000;font-weight:700}
.row{display:flex;gap:8px}
.slot{background:#181822;padding:12px;border-radius:12px;margin:10px 0}
.small{font-size:12px;color:#aaa;word-break:break-all}
.copy{background:#2bffcc}
.del{background:#ff5252;color:#fff}
.edit{background:#ffd54f;color:#000}
.range{width:100%}
label{font-size:13px;color:#bbb}
.toggle{display:flex;justify-content:space-between;align-items:center}
.hidden{display:none}
</style>
</head>
<body>

<div class="card">
<h2>üîê Create Slot</h2>
<input id="slotName" placeholder="Slot / App Name">
<button onclick="createSlot()">Create Slot (Auto 15‚ÄëDigit ID)</button>
</div>

<div class="card">
<h2>üì¶ All Slots</h2>
<div id="slotList"></div>
</div>

<div class="card hidden" id="editor">
<h2>‚öôÔ∏è Edit Slot</h2>
<div class="small" id="currentSlot"></div>

<div class="toggle">
<span>Dialog Enabled</span>
<input type="checkbox" id="enabled">
</div>

<input id="title" placeholder="App Title">
<textarea id="desc" placeholder="App Description"></textarea>
<input id="verify" placeholder="Verification URL">
<input id="howto" placeholder="How To Verify URL">
<input id="telegram" placeholder="Telegram URL">
<input id="shortener" placeholder="Shortener API">

<label>Border Color</label>
<input type="range" min="0" max="360" id="border" class="range">
<label>Neon Color</label>
<input type="range" min="0" max="360" id="neon" class="range">
<label>Warning Color</label>
<input type="range" min="0" max="360" id="warn" class="range">
<label>Error Color</label>
<input type="range" min="0" max="360" id="error" class="range">

<button onclick="saveSlot()">Save Changes</button>
<button class="del" onclick="closeEditor()">Close Editor</button>
</div>

<script>
// üî• FIXED & TESTED FIREBASE LOGIC
firebase.initializeApp({
  databaseURL: 'https://real-apk-pin-default-rtdb.firebaseio.com'
});

const db = firebase.database();
let editId = null;

function genId() {
  const c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let s = '';
  for (let i = 0; i < 15; i++) s += c[Math.floor(Math.random() * c.length)];
  return s;
}

function hsv(h) {
  return `hsl(${h},100%,50%)`;
}

// ‚úÖ CREATE SLOT (FIXED)
function createSlot() {
  const name = slotName.value.trim();
  if (!name) {
    alert('Enter slot name');
    return;
  }

  const id = genId();

  db.ref('users/' + id).set({
    meta: {
      name: name,
      created: Date.now()
    },
    config: {},
    'config.json': {
      enabled: true
    }
  }).then(() => {
    alert('Slot Created:
' + id);
    slotName.value = '';
    loadSlots(); // üî• FORCE REFRESH
  }).catch(e => alert(e.message));
}

// ‚úÖ LIVE SLOT LIST (FIXED)
function loadSlots() {
  db.ref('users').once('value').then(snap => {
    slotList.innerHTML = '';
    if (!snap.exists()) {
      slotList.innerHTML = '<div class="small">No slots created</div>';
      return;
    }

    snap.forEach(child => {
      const id = child.key;
      const name = child.child('meta/name').val() || 'Unnamed Slot';

      slotList.innerHTML += `
        <div class="slot">
          <b>${name}</b>
          <div class="small">${id}</div>
          <div class="row">
            <button class="copy" onclick="copyId('${id}')">Copy</button>
            <button class="edit" onclick="editSlot('${id}')">Edit</button>
            <button class="del" onclick="deleteSlot('${id}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function copyId(id) {
  navigator.clipboard.writeText(id);
  alert('Copied Slot ID');
}

function deleteSlot(id) {
  if (!confirm('Delete slot?')) return;
  db.ref('users/' + id).remove().then(loadSlots);
}

// ‚úÖ EDIT SLOT (FIXED PATH)
function editSlot(id) {
  editId = id;
  editor.classList.remove('hidden');
  currentSlot.innerText = 'Slot ID: ' + id;

  db.ref('users/' + id + '/config.json').once('value').then(s => {
    const d = s.val() || {};
    enabled.checked = d.enabled !== false;
    title.value = d.app_title || '';
    desc.value = d.app_description || '';
    verify.value = d.verification_url || '';
    howto.value = d.how_to_verify_url || '';
    telegram.value = d.telegram_url || '';
    shortener.value = d.shortener_api || '';
  });
}

// ‚úÖ SAVE SLOT (FIXED PATH)
function saveSlot() {
  if (!editId) return;

  db.ref('users/' + editId + '/config.json').update({
    enabled: enabled.checked,
    app_title: title.value,
    app_description: desc.value,
    verification_url: verify.value,
    how_to_verify_url: howto.value,
    telegram_url: telegram.value,
    shortener_api: shortener.value,
    verification_duration_hours: 12,
    colors: {
      border: hsv(border.value),
      status_neon: hsv(neon.value),
      status_warning: hsv(warn.value),
      status_error: hsv(error.value)
    }
  }).then(() => alert('Saved'));
}

function closeEditor() {
  editor.classList.add('hidden');
  editId = null;
}

// üî• AUTO LOAD
loadSlots();
</script>
</body>
</html>