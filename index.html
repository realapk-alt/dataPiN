<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberXLink Controller</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .master-container { width: 100%; max-width: 600px; }
        
        /* HEADER & LOGIN */
        .header { text-align: center; margin-bottom: 20px; }
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 300px; text-align: center; }
        .secure-input { width: 90%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: 8px; text-align: center; }

        /* APP CARDS (OLD STYLE) */
        .app-card { background: white; border-radius: 12px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .app-title { font-size: 16px; font-weight: bold; color: #333; }
        .card-body { padding: 20px; display: none; background: #fdfdfd; }
        .show { display: block; }

        /* INPUTS */
        .input-group { margin-bottom: 10px; }
        label { font-size: 12px; font-weight: bold; color: #555; display: block; margin-bottom: 5px; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        /* BUTTONS */
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; width: 100%; margin-top: 10px; }
        .btn-primary { background: #007AFF; }
        .btn-save { background: #28a745; }
        .btn-danger { background: #dc3545; width: auto; font-size: 12px; padding: 5px 10px; }

        /* COLOR PICKER TRIGGER */
        .color-row { display: flex; gap: 10px; margin-top: 10px; }
        .color-box { flex: 1; border: 1px solid #ddd; border-radius: 6px; padding: 8px; text-align: center; cursor: pointer; background: #fafafa; }
        .color-preview { height: 25px; border-radius: 4px; border: 1px solid #ccc; margin-bottom: 5px; }
        .color-label { font-size: 11px; color: #666; }

        /* RGB MODAL */
        #rgbModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .rgb-box { background: white; padding: 25px; border-radius: 15px; width: 85%; max-width: 300px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .range-wrap { display: flex; align-items: center; margin: 15px 0; }
        .range-label { width: 20px; font-weight: bold; }
        input[type=range] { flex: 1; margin: 0 10px; }
        .final-preview { height: 50px; border-radius: 8px; border: 2px solid #eee; margin-bottom: 15px; }
        .hex-display { font-family: monospace; background: #eee; padding: 5px; border-radius: 4px; display: inline-block; margin-bottom: 15px; }

    </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
    <div class="login-box">
        <h3>Admin Login</h3>
        <input type="password" id="adminPass" class="secure-input" placeholder="Enter Password">
        <button class="btn btn-primary" onclick="attemptLogin()">Login</button>
        <p id="loginMsg" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>
</div>

<!-- RGB MODAL -->
<div id="rgbModal">
    <div class="rgb-box">
        <h4>Pick Color</h4>
        <div class="final-preview" id="modalPreview"></div>
        <div class="hex-display" id="modalHex">#000000</div>

        <div class="range-wrap"><span class="range-label" style="color:red">R</span><input type="range" min="0" max="255" id="sliderR" oninput="updateRgb()"></div>
        <div class="range-wrap"><span class="range-label" style="color:green">G</span><input type="range" min="0" max="255" id="sliderG" oninput="updateRgb()"></div>
        <div class="range-wrap"><span class="range-label" style="color:blue">B</span><input type="range" min="0" max="255" id="sliderB" oninput="updateRgb()"></div>

        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:#888" onclick="closePicker()">Cancel</button>
            <button class="btn btn-primary" onclick="confirmColor()">PICK</button>
        </div>
    </div>
</div>

<!-- DASHBOARD -->
<div class="master-container" id="dashboard" style="display:none;">
    <div class="header">
        <h2>ðŸ”¥ CyberX Control</h2>
    </div>

    <!-- Create App -->
    <div class="app-card" style="padding:20px; border-left: 5px solid #007AFF;">
        <label>Create New App Slot</label>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="newAppName" placeholder="App Name (e.g. Mod v1)">
            <button class="btn btn-primary" style="width: auto; margin-top:0;" onclick="createApp()">+ Create</button>
        </div>
    </div>

    <div id="appsList"></div>
</div>

<script>
    const DB_URL = "https://cyberxlink-db-default-rtdb.firebaseio.com";
    let activeInputId = null; 
    let activePreviewId = null;

    // --- LOGIN ---
    function attemptLogin() {
        const p = document.getElementById('adminPass').value;
        fetch(DB_URL + "/admin_password.json").then(r=>r.json()).then(d=>{
            if(String(d)===p) {
                document.getElementById('loginScreen').style.display='none';
                document.getElementById('dashboard').style.display='block';
                loadApps();
            } else document.getElementById('loginMsg').innerText="Wrong Password";
        });
    }

    // --- RGB PICKER ---
    function openPicker(inputId, previewId) {
        activeInputId = inputId;
        activePreviewId = previewId;
        
        const hex = document.getElementById(inputId).value || "#000000";
        // Hex to RGB
        const r = parseInt(hex.substr(1,2), 16) || 0;
        const g = parseInt(hex.substr(3,2), 16) || 0;
        const b = parseInt(hex.substr(5,2), 16) || 0;

        document.getElementById('sliderR').value = r;
        document.getElementById('sliderG').value = g;
        document.getElementById('sliderB').value = b;
        updateRgb();
        
        document.getElementById('rgbModal').style.display = 'flex';
    }

    function updateRgb() {
        const r = parseInt(document.getElementById('sliderR').value);
        const g = parseInt(document.getElementById('sliderG').value);
        const b = parseInt(document.getElementById('sliderB').value);
        const hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        
        document.getElementById('modalPreview').style.background = hex;
        document.getElementById('modalHex').innerText = hex;
    }

    function confirmColor() {
        const hex = document.getElementById('modalHex').innerText;
        document.getElementById(activeInputId).value = hex;
        document.getElementById(activePreviewId).style.background = hex;
        closePicker();
    }

    function closePicker() { document.getElementById('rgbModal').style.display = 'none'; }

    // --- APP LOGIC ---
    function loadApps() {
        fetch(DB_URL + "/apps.json").then(r=>r.json()).then(d=>{
            const l = document.getElementById('appsList'); l.innerHTML="";
            if(d) Object.keys(d).forEach(k=>renderCard(k,d[k]));
        });
    }

    function createApp() {
        const n = document.getElementById('newAppName').value;
        if(!n) return;
        const id = 'slot_' + Math.random().toString(36).substr(2, 8);
        const data = {
            name: n,
            // KEYS FIXED FOR ANDROID MATCH
            update: { active:false, title:"Update", msg:"Msg", url:"", bg_color:"#FFFFFF", text_color:"#000000", btn_color:"#007AFF" },
            inject: { active:false, zip:"", ver:1, bg_color:"#FFFFFF", text_color:"#000000", progress_color:"#007AFF" }
        };
        fetch(DB_URL+"/apps/"+id+".json", {method:'PUT', body:JSON.stringify(data)}).then(()=>{
            document.getElementById('newAppName').value=""; loadApps();
        });
    }

    function saveApp(id) {
        const btn = document.getElementById('btn-'+id);
        btn.innerText = "Saving...";
        
        const data = {
            name: document.getElementById('n-'+id).innerText,
            update: {
                active: document.getElementById('ua-'+id).checked,
                title: document.getElementById('ut-'+id).value,
                msg: document.getElementById('um-'+id).value,
                url: document.getElementById('uu-'+id).value,
                bg_color: document.getElementById('ubg-'+id).value, // Fixed key name
                text_color: document.getElementById('utx-'+id).value,
                btn_color: document.getElementById('ubc-'+id).value
            },
            inject: {
                active: document.getElementById('ia-'+id).checked,
                zip: document.getElementById('iz-'+id).value,
                ver: parseInt(document.getElementById('iv-'+id).value),
                bg_color: document.getElementById('ibg-'+id).value,
                text_color: document.getElementById('itx-'+id).value,
                progress_color: document.getElementById('ipc-'+id).value
            }
        };

        fetch(DB_URL+"/apps/"+id+".json", {method:'PUT', body:JSON.stringify(data)}).then(()=>{
            btn.innerText = "âœ… Saved!"; setTimeout(()=>btn.innerText="SAVE SETTINGS", 1500);
        });
    }

    function copyId(id) { navigator.clipboard.writeText(id); alert("ID Copied: "+id); }
    function deleteApp(id) { if(confirm("Delete?")) fetch(DB_URL+"/apps/"+id+".json", {method:'DELETE'}).then(loadApps); }

    function renderCard(id, d) {
        // Fallback for old data structure
        const u = d.update || {};
        const i = d.inject || {};

        const html = `
        <div class="app-card">
            <div class="card-header" onclick="document.getElementById('b-${id}').classList.toggle('show')">
                <div>
                    <span class="app-title" id="n-${id}">${d.name}</span>
                    <span style="font-size:11px; background:#eee; padding:2px 5px; margin-left:5px" onclick="event.stopPropagation(); copyId('${id}')">ID: ${id}</span>
                </div>
                <span>â–¼</span>
            </div>
            <div class="card-body" id="b-${id}">
                
                <!-- Update Config -->
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <strong>Update Dialog</strong>
                    <input type="checkbox" id="ua-${id}" ${u.active?'checked':''}>
                </div>
                <input type="text" id="ut-${id}" value="${u.title}" placeholder="Title">
                <input type="text" id="um-${id}" value="${u.msg}" placeholder="Message" style="margin-top:5px">
                <input type="text" id="uu-${id}" value="${u.url}" placeholder="URL" style="margin-top:5px">
                
                <div class="color-row">
                    <div class="color-box" onclick="openPicker('ubg-${id}', 'pubg-${id}')">
                        <div class="color-preview" id="pubg-${id}" style="background:${u.bg_color}"></div>
                        <span class="color-label">BG</span>
                        <input type="hidden" id="ubg-${id}" value="${u.bg_color}">
                    </div>
                    <div class="color-box" onclick="openPicker('utx-${id}', 'putx-${id}')">
                        <div class="color-preview" id="putx-${id}" style="background:${u.text_color}"></div>
                        <span class="color-label">Text</span>
                        <input type="hidden" id="utx-${id}" value="${u.text_color}">
                    </div>
                    <div class="color-box" onclick="openPicker('ubc-${id}', 'pubc-${id}')">
                        <div class="color-preview" id="pubc-${id}" style="background:${u.btn_color}"></div>
                        <span class="color-label">Btn</span>
                        <input type="hidden" id="ubc-${id}" value="${u.btn_color}">
                    </div>
                </div>

                <hr style="margin:20px 0; border:0; border-top:1px solid #eee">

                <!-- Inject Config -->
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <strong>Data Injection</strong>
                    <input type="checkbox" id="ia-${id}" ${i.active?'checked':''}>
                </div>
                <input type="text" id="iz-${id}" value="${i.zip}" placeholder="ZIP URL">
                <input type="number" id="iv-${id}" value="${i.ver}" placeholder="Version Code" style="margin-top:5px">

                <div class="color-row">
                    <div class="color-box" onclick="openPicker('ibg-${id}', 'pibg-${id}')">
                        <div class="color-preview" id="pibg-${id}" style="background:${i.bg_color}"></div>
                        <span class="color-label">BG</span>
                        <input type="hidden" id="ibg-${id}" value="${i.bg_color}">
                    </div>
                    <div class="color-box" onclick="openPicker('itx-${id}', 'pitx-${id}')">
                        <div class="color-preview" id="pitx-${id}" style="background:${i.text_color}"></div>
                        <span class="color-label">Text</span>
                        <input type="hidden" id="itx-${id}" value="${i.text_color}">
                    </div>
                    <div class="color-box" onclick="openPicker('ipc-${id}', 'pipc-${id}')">
                        <div class="color-preview" id="pipc-${id}" style="background:${i.progress_color}"></div>
                        <span class="color-label">Prog</span>
                        <input type="hidden" id="ipc-${id}" value="${i.progress_color}">
                    </div>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button class="btn btn-danger" onclick="deleteApp('${id}')">Delete</button>
                    <button class="btn btn-save" id="btn-${id}" style="width:70%" onclick="saveApp('${id}')">SAVE SETTINGS</button>
                </div>

            </div>
        </div>`;
        document.getElementById('appsList').insertAdjacentHTML('beforeend', html);
    }
</script>
</body>
</html>


