<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Static Uploader â€” GitHub Pages Friendly</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{background:#0f172a;color:#e6eef8}
  .card{border-radius:12px;background:#0b1220;border:1px solid rgba(255,255,255,0.04)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;color:#cbd5e1}
  .small-muted{color:#94a3b8}
  a.url{color:#7dd3fc;word-break:break-all}
</style>
</head>
<body>
<div class="container py-5">
  <div class="row">
    <div class="col-md-6 mx-auto">
      <div class="card p-3">
        <h4 class="mb-2">Static Uploader (GitHub Pages)</h4>
        <p class="small-muted">This page will attempt to upload files directly from the browser to public file hosts (no server required). It tries providers in order and shows the first working direct link.</p>
        <form id="form">
          <div class="mb-2"><input id="file" type="file" class="form-control" required></div>
          <div class="d-flex gap-2">
            <button class="btn btn-primary" id="upload">Upload</button>
            <button type="button" id="clear" class="btn btn-light">Clear</button>
          </div>
        </form>
        <hr>
        <div id="status" class="mono small-muted">Idle</div>
        <div id="result" class="mt-2"></div>
        <hr>
        <div class="small-muted">Notes: Some hosts may block uploads from GitHub Pages due to CORS. If uploads fail, try using a small PHP server or VPS backend (I can provide that).</div>
      </div>
    </div>
  </div>
</div>
<script>
const form = document.getElementById('form');
const fileEl = document.getElementById('file');
const status = document.getElementById('status');
const result = document.getElementById('result');
const clearBtn = document.getElementById('clear');

function setStatus(txt){ status.textContent = txt; }
function showResult(html){ result.innerHTML = html; }

async function tryAnonFiles(file){
  setStatus('Trying anonfiles.com ...');
  const fd = new FormData();
  fd.append('file', file);
  try {
    const res = await fetch('https://api.anonfiles.com/upload', { method: 'POST', body: fd });
    const txt = await res.text();
    // try parse JSON
    const j = JSON.parse(txt);
    if (j && j.status && j.data && j.data.file && j.data.file.url && j.data.file.url.full) {
      return { ok:true, url:j.data.file.url.full, provider:'anonfiles' };
    } else {
      return { ok:false, error: 'Unexpected response' };
    }
  } catch(e){
    return { ok:false, error: e.message || e.toString() };
  }
}

async function tryPixeldrain(file){
  setStatus('Trying pixeldrain.com ...');
  const fd = new FormData();
  fd.append('file', file);
  try {
    const res = await fetch('https://pixeldrain.com/api/file', { method:'POST', body:fd });
    const j = await res.json();
    // pixeldrain returns an object with 'success' and 'id' or similar
    // if id present, direct link can be: https://pixeldrain.com/file/{id}
    if (j && (j.success || j.id)) {
      const id = j.id || j.result || j.success;
      const url = (j.id) ? ('https://pixeldrain.com/file/' + j.id) : null;
      return { ok:true, url:url || ('https://pixeldrain.com/file/' + j.id), provider:'pixeldrain' };
    } else if (typeof j === 'string' && j.length>0) {
      return { ok:true, url:'https://pixeldrain.com/file/' + j, provider:'pixeldrain' };
    } else {
      return { ok:false, error: 'Unexpected response' };
    }
  } catch(e){
    return { ok:false, error: e.message || e.toString() };
  }
}

async function tryFileIo(file){
  setStatus('Trying file.io ...');
  const fd = new FormData();
  fd.append('file', file);
  try {
    const res = await fetch('https://file.io', { method:'POST', body: fd });
    const j = await res.json();
    // file.io returns {success:true,link:"https://file.io/xxxx"}
    if (j && (j.link || j.success)) {
      const url = j.link || j[Object.keys(j)[0]];
      return { ok:true, url: url, provider:'file.io' };
    } else {
      return { ok:false, error: 'Unexpected response' };
    }
  } catch(e){
    return { ok:false, error: e.message || e.toString() };
  }
}

async function attemptUpload(file){
  // Try providers in order. Return first success or error list.
  const providers = [tryAnonFiles, tryPixeldrain, tryFileIo];
  const errors = [];
  for (const fn of providers){
    try {
      const r = await fn(file);
      if (r.ok) return r;
      errors.push({provider:r.provider||fn.name, err:r.error||'unknown'});
    } catch(e){
      errors.push({provider:fn.name, err: e.message || e.toString()});
    }
  }
  return { ok:false, errors:errors };
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = fileEl.files[0];
  if (!f) { setStatus('Please choose a file'); return; }
  setStatus('Starting upload...');
  showResult('');
  try {
    const res = await attemptUpload(f);
    if (res.ok) {
      setStatus('Upload successful via ' + res.provider);
      showResult('<div class="alert alert-success">Uploaded: <a class="url" href="'+res.url+'" target="_blank">'+res.url+'</a><br><small class="small-muted">Provider: '+res.provider+'</small></div>');
    } else {
      setStatus('All providers failed');
      let html = '<div class="alert alert-danger"><strong>All providers failed.</strong><br>Errors:<ul>';
      for (const e of res.errors) {
        html += '<li><code>' + (e.provider||'unknown') + '</code>: ' + (e.err||'error') + '</li>';
      }
      html += '</ul></div>';
      showResult(html);
    }
  } catch(e){
    setStatus('Upload error: ' + e.message);
    showResult('<div class="alert alert-danger">Unexpected error: '+e.message+'</div>');
  }
});

clearBtn.addEventListener('click', ()=>{ fileEl.value=''; setStatus('Idle'); showResult(''); });
</script>
</body>
</html>
