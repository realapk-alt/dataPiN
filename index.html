<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberX Secure Panel</title>
    <style>
        :root { --bg: #e0e5ec; --primary: #007AFF; --text: #333; --shadow-light: #ffffff; --shadow-dark: #a3b1c6; }
        body { background: var(--bg); font-family: -apple-system, sans-serif; padding: 20px; color: var(--text); -webkit-tap-highlight-color: transparent; }
        
        /* NEUMORPHISM UI */
        .neu-card { border-radius: 20px; background: var(--bg); box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light); padding: 20px; margin-bottom: 25px; }
        .neu-btn { border-radius: 12px; background: var(--bg); box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light); color: var(--primary); font-weight: bold; border: none; padding: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .neu-btn:active { box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light); }
        .neu-input { width: 100%; background: var(--bg); border: none; box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); border-radius: 10px; padding: 14px; outline: none; color: var(--text); font-weight: 600; margin-bottom: 10px; box-sizing: border-box; }

        .header h1 { text-align: center; margin: 0 0 20px 0; color: #444; }
        .badge { font-size: 10px; background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; }

        /* SWITCH */
        .switch-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #d1d9e6; border-radius: 34px; box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light); transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: var(--primary); border-radius: 50%; transition: .4s; }
        input:checked + .slider:before { transform: translateX(20px); background: #34C759; }

        /* UPLOAD ROW */
        .action-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .btn-icon { width: 45px; height: 45px; font-size: 20px; color: #333; }
        .delete-btn { color: #FF3B30; margin-top: 15px; width: 100%; }

        /* MODAL */
        #modalOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); z-index: 99; display: none; align-items: center; justify-content: center; }
        .modal-box { width: 300px; text-align: center; }

    </style>
</head>
<body>

    <!-- GITHUB MODAL -->
    <div id="modalOverlay">
        <div class="neu-card modal-box">
            <h3>GitHub Settings</h3>
            <input type="text" id="ghToken" class="neu-input" placeholder="Token (ghp_...)">
            <input type="text" id="ghOwner" class="neu-input" placeholder="Username">
            <input type="text" id="ghRepo" class="neu-input" placeholder="Repository">
            <button class="neu-btn" onclick="saveGh()" style="width:100%">SAVE</button>
            <button class="neu-btn" onclick="document.getElementById('modalOverlay').style.display='none'" style="width:100%; margin-top:10px; color:#666">CLOSE</button>
        </div>
    </div>

    <div class="container" style="max-width:600px; margin:0 auto;">
        <div class="header">
            <h1>CyberX <span class="badge">SECURE</span></h1>
            <button class="neu-btn" style="position:absolute; right:10px; top:10px; width:40px; height:40px;" onclick="document.getElementById('modalOverlay').style.display='flex'">‚öôÔ∏è</button>
        </div>

        <!-- CREATE -->
        <div class="neu-card" style="display:flex; gap:10px; align-items:center;">
            <input type="text" id="newApp" class="neu-input" placeholder="New App Name..." style="margin:0">
            <button class="neu-btn" style="width:50px;" onclick="createNew()">+</button>
        </div>

        <div id="listArea"></div>
    </div>

    <input type="file" id="fileInput" style="display:none" onchange="handleFile(this)">

<script>
    const DB = "https://cyberxlink-db-default-rtdb.firebaseio.com";
    let upId;

    // LOGIN CHECK (Simple)
    if(!localStorage.getItem('admin_ok')) {
        const pass = prompt("Enter Admin Password:");
        fetch(DB+"/admin_password.json").then(r=>r.json()).then(d=>{
            if(String(d)!==pass) { alert("Wrong Password"); location.reload(); }
            else localStorage.setItem('admin_ok', true);
        });
    }

    // LOAD DATA
    function loadData() {
        fetch(DB+"/apps.json").then(r=>r.json()).then(d=>{
            const l = document.getElementById('listArea'); l.innerHTML="";
            if(d) Object.keys(d).reverse().forEach(k=>drawSlot(k,d[k]));
        });
    }
    loadData();

    function createNew() {
        const n = document.getElementById('newApp').value; if(!n) return;
        const id = 'slot_'+Math.random().toString(36).substr(2,6);
        const d = { name:n, inject:{active:false, zip:"", pass:"", ver:1} };
        fetch(DB+"/apps/"+id+".json",{method:'PUT',body:JSON.stringify(d)}).then(()=>{
            document.getElementById('newApp').value=""; loadData();
        });
    }

    function saveSlot(id) {
        const btn = document.getElementById('btn-'+id); btn.innerText="Saving...";
        const d = {
            name: document.getElementById('n-'+id).innerText,
            inject: {
                active: document.getElementById('ia-'+id).checked,
                zip: document.getElementById('iz-'+id).value,
                pass: document.getElementById('pw-'+id).value, // Password Key
                ver: parseInt(document.getElementById('iv-'+id).value)
            }
        };
        fetch(DB+"/apps/"+id+"/inject.json",{method:'PUT',body:JSON.stringify(d.inject)})
        .then(()=>{ btn.innerText="SAVED"; setTimeout(()=>btn.innerText="Save Changes",1500); });
    }

    function delSlot(id) { if(confirm("Delete Slot?")) fetch(DB+"/apps/"+id+".json",{method:'DELETE'}).then(loadData); }
    
    // GITHUB UPLOAD
    function saveGh() {
        localStorage.setItem('gh_t', document.getElementById('ghToken').value);
        localStorage.setItem('gh_o', document.getElementById('ghOwner').value);
        localStorage.setItem('gh_r', document.getElementById('ghRepo').value);
        document.getElementById('modalOverlay').style.display='none';
    }

    function trigUp(id) {
        if(!localStorage.getItem('gh_t')) { alert("Set GitHub Config First (Gear Icon)"); return; }
        const pass = document.getElementById('pw-'+id.split('-')[1]).value;
        if(!pass) { alert("Please enter a ZIP Password first! (This will be used to encrypt)"); return; }
        upId = id; document.getElementById('fileInput').click();
    }

    function handleFile(inp) {
        if(inp.files[0]) {
            const f = inp.files[0];
            const slotId = upId.split('-')[1];
            const pass = document.getElementById('pw-'+slotId).value;
            const btn = document.getElementById(upId).previousElementSibling;
            
            btn.innerText = "üîí"; // Encrypting
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const rawData = new Uint8Array(e.target.result);
                
                // --- XOR ENCRYPTION ---
                for(let i=0; i<rawData.length; i++) {
                    rawData[i] = rawData[i] ^ pass.charCodeAt(i % pass.length);
                }
                
                let binary = '';
                const len = rawData.byteLength;
                for (let i = 0; i < len; i++) { binary += String.fromCharCode(rawData[i]); }
                const base64 = btoa(binary);

                uploadToGH(f.name, base64, btn);
            };
            reader.readAsArrayBuffer(f);
        }
        inp.value = '';
    }

    function uploadToGH(name, content, btn) {
        const t=localStorage.getItem('gh_t'), o=localStorage.getItem('gh_o'), r=localStorage.getItem('gh_r');
        const sName = "encrypted_" + Date.now() + ".zip"; // Name on GitHub
        
        fetch(`https://api.github.com/repos/${o}/${r}/contents/${sName}`, {
            method:'PUT', headers: { 'Authorization': `token ${t}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message:"Encrypted Upload", content:content })
        })
        .then(res=>res.json()).then(d=>{
            if(d.content) {
                document.getElementById('iz-'+upId.split('-')[1]).value = d.content.download_url;
                btn.innerText = "‚úÖ"; setTimeout(()=>btn.innerText="‚òÅÔ∏è", 2000);
            } else { alert("Error: "+d.message); btn.innerText="‚ùå"; }
        });
    }

    function deleteFromGH(id) {
        if(!confirm("Delete file from GitHub?")) return;
        const url = document.getElementById('iz-'+id).value;
        if(!url) return;
        const name = url.split('/').pop();
        const t=localStorage.getItem('gh_t'), o=localStorage.getItem('gh_o'), r=localStorage.getItem('gh_r');
        
        fetch(`https://api.github.com/repos/${o}/${r}/contents/${name}`, { headers: { 'Authorization': `token ${t}` } })
        .then(res=>res.json()).then(d=>{
            if(d.sha) {
                fetch(`https://api.github.com/repos/${o}/${r}/contents/${name}`, {
                    method:'DELETE', headers: { 'Authorization': `token ${t}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message:"Deleted", sha:d.sha })
                }).then(()=>{ alert("Deleted!"); document.getElementById('iz-'+id).value=""; });
            }
        });
    }

    // DRAW UI
    function drawSlot(id, d) {
        const i = d.inject||{};
        const h = `
        <div class="neu-card">
            <div onclick="document.getElementById('b_${id}').classList.toggle('show')" style="display:flex; justify-content:space-between; cursor:pointer;">
                <b>${d.name}</b> <span>‚ñº</span>
            </div>
            <div id="b_${id}" style="display:none; margin-top:20px; border-top:1px solid #ccc; padding-top:15px;">
                
                <div class="switch-row"><span>Enable Injection</span><label class="switch"><input type="checkbox" id="ia-${id}" ${i.active?'checked':''}><span class="slider"></span></label></div>
                
                <label style="font-size:11px; font-weight:bold; color:#888;">ENCRYPTION PASSWORD</label>
                <input class="neu-input" id="pw-${id}" value="${i.pass}" placeholder="Set a strong password first">

                <div class="action-row">
                    <button class="neu-btn btn-icon" onclick="triggerUpload('up-${id}')">‚òÅÔ∏è</button>
                    <button class="neu-btn btn-icon" style="color:red" onclick="deleteFromGH('${id}')" id="up-${id}">üóëÔ∏è</button>
                    <input class="neu-input" style="margin:0" id="iz-${id}" value="${i.zip}" placeholder="Encrypted Link (Auto)">
                </div>

                <label style="font-size:11px; font-weight:bold; color:#888;">VERSION</label>
                <input type="number" class="neu-input" id="iv-${id}" value="${i.ver}">

                <button class="neu-btn" id="btn-${id}" style="width:100%; margin-top:15px;" onclick="saveSlot('${id}')">SAVE SETTINGS</button>
                <button class="neu-btn delete-btn" onclick="delSlot('${id}')">Delete Slot</button>
            </div>
        </div>`;
        document.getElementById('listArea').insertAdjacentHTML('beforeend', h);
    }
</script>
</body>
</html>


